"use strict";
var Capabilities;
(function (Capabilities) {
    Capabilities["REL1XX"] = "REL1XX";
    Capabilities["FORKING"] = "FORKING";
    Capabilities["PRECONDITION"] = "PRECONDITION";
    Capabilities["PEM"] = "PEM";
    Capabilities["UPDATE"] = "UPDATE";
})(Capabilities || (Capabilities = {}));
var Annotype;
(function (Annotype) {
    Annotype["CONNECT"] = "CONNECT";
    Annotype["RINGING"] = "RING";
})(Annotype || (Annotype = {}));
var CallPollActionType;
(function (CallPollActionType) {
    CallPollActionType["Accept"] = "accept";
    CallPollActionType["Forward"] = "forward";
    CallPollActionType["Reject"] = "reject";
})(CallPollActionType || (CallPollActionType = {}));
var CallStartActionType;
(function (CallStartActionType) {
    CallStartActionType[CallStartActionType["Abort"] = 0] = "Abort";
    CallStartActionType[CallStartActionType["Forward"] = 1] = "Forward";
    CallStartActionType[CallStartActionType["RejectMrf"] = 2] = "RejectMrf";
})(CallStartActionType || (CallStartActionType = {}));
var MediaOperationActionType;
(function (MediaOperationActionType) {
    MediaOperationActionType["PerformMediaOperation"] = "performMediaOperation";
})(MediaOperationActionType || (MediaOperationActionType = {}));
var MediaOperationContentType;
(function (MediaOperationContentType) {
    MediaOperationContentType["MSML"] = "application/msml+xml";
})(MediaOperationContentType || (MediaOperationContentType = {}));
;
;
function inputvalidation(session, event, localParams) {
    var log = session.log;
    try {
        if (session["s_SIPInvite"] != null) {
            if (session["s_SIPInvite"]["event-type"] !== null && (session["s_SIPInvite"]["event-type"] === "sip" || session["s_SIPInvite"]["event-type"] === "occp")) {
                if (session["s_SIPInvite"]["event-name"] !== null && session["s_SIPInvite"]["event-name"] === "sip.callStart.NONE")
                    log.debug("got sip invite");
                else
                    return "error.input.sipinviteincorrecteventname";
            }
            else {
                return "error.input.sipinviteincorrecteventtype";
            }
        }
        else {
            return "error.input.sipinvitemissing";
        }
        if (event["announcement"] != null) {
            log.debug("announcement: {}", event["announcement"]);
            session["mrf"]["announcement"] = event["announcement"];
        }
        else {
            return "error.input.actionmissing";
        }
        if ((event["action"] != null) && ((event["action"] === "promptandcollect") || (event["action"] === "playannouncement"))) {
            log.debug("action: {}", event["action"]);
            if (event["action"] === "promptandcollect")
                session["mrf"]["action"] = "promptandcollect";
            else if (event["action"] === "playannouncement")
                session["mrf"]["action"] = "playannouncement";
            else
                return "error.input.actionincorrect";
        }
        else {
            return "error.input.actionmissing";
        }
        if (event["earlydialog"] != null) {
            log.debug("earlydialog: {}", event["earlydialog"]);
            if (event["earlydialog"] === true) {
                session["mrf"]["earlydialog"] = true;
                return "true";
            }
            else if (event["earlydialog"] === false) {
                session["mrf"]["earlydialog"] = false;
                return "false";
            }
            else {
                return "error.input.earlydialogincorrect";
            }
        }
        else {
            return "error.input.earlydialog";
        }
    }
    catch (e) {
        log.debug("Log: {}", e);
        return "error.exception";
    }
}
function handle200OKINVITE(session, event, localParams) {
    var log = session.log;
    try {
        var eventData = localParams.message;
        session["mrf"]["headerrulevar=null"];
        session["mrf"]["headerrulesselect"] = null;
        session["mrf"]["ringingtones"] = null;
        var pollAction = void 0;
        pollAction = pollAction || {};
        pollAction.type = CallPollActionType.Accept;
        session["mrf"]["sendAction"] = JSON.stringify(pollAction);
        session["mrf"]["time200OKINVITE"] = Math.floor(new Date() / 1000);
        var to = eventData.SIP.To;
        if (to != null) {
            log.debug("received from MRF to tag:{}", to);
            session["mrf"]["callstate"] = "MRFCONNECTED200OK";
            session["mrf"]["downStreamToTag"] = to.tag;
            return "success";
        }
        else {
            log.debug("received from MRF no to tag:{}", to);
            return "error.nototag";
        }
    }
    catch (e) {
        log.debug("Log: {}", e);
        return "error.exception";
    }
}
function handle200OKINFO(session, event, localParams) {
    var log = session.log;
    try {
        session["mrf"]["time200OKINFO"] = Math.floor(new Date() / 1000);
        session["mrf"]["callstate"] = "MRFCONNECTED";
        if (event.SIP.content.json.msml.event.name[2] != null) {
            if (event.SIP.content.json.msml.event.name[2] == "dtmf.digits") {
                log.debug("Got DTMF digits;");
                if (event.SIP.content.json.msml.event.value[1] != null) {
                    session["mrf"]["dtmfdigit"] = event.SIP.content.json.msml.event.value[1];
                }
                else {
                    session["mrf"]["dtmfdigit"] = "0";
                }
            }
            else {
                log.debug("No DTMF digits;");
            }
        }
    }
    catch (e) {
        log.debug("Log: {}", e);
        return "error.exception";
    }
    return session["mrf"]["dtmfdigit"];
}
function callAnswered(session, event, localParams) {
    var log = session.log;
    try {
        session["mrf"]["callstate"] = "ANSWERED";
        session["mrf"]["answertime"] = Math.floor(new Date() / 1000);
        return "success";
    }
    catch (e) {
        log.debug("Log: {}", e);
        return "error.exception";
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kdWxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibW9kdWxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFVQSxJQUFLLFlBTUo7QUFORCxXQUFLLFlBQVk7SUFDZixpQ0FBaUIsQ0FBQTtJQUNqQixtQ0FBa0IsQ0FBQTtJQUNsQiw2Q0FBMkIsQ0FBQTtJQUMzQiwyQkFBUyxDQUFBO0lBQ1QsaUNBQWUsQ0FBQTtBQUNqQixDQUFDLEVBTkksWUFBWSxLQUFaLFlBQVksUUFNaEI7QUFzREQsSUFBSyxRQUdKO0FBSEQsV0FBSyxRQUFRO0lBQ1gsK0JBQW1CLENBQUE7SUFDbkIsNEJBQWdCLENBQUE7QUFDbEIsQ0FBQyxFQUhJLFFBQVEsS0FBUixRQUFRLFFBR1o7QUF1QkQsSUFBSyxrQkFJSjtBQUpELFdBQUssa0JBQWtCO0lBQ3RCLHVDQUFpQixDQUFBO0lBQ2pCLHlDQUFtQixDQUFBO0lBQ25CLHVDQUFpQixDQUFBO0FBQ2xCLENBQUMsRUFKSSxrQkFBa0IsS0FBbEIsa0JBQWtCLFFBSXRCO0FBRUQsSUFBSyxtQkFJSjtBQUpELFdBQUssbUJBQW1CO0lBQ3ZCLCtEQUFTLENBQUE7SUFDVCxtRUFBVyxDQUFBO0lBQ1gsdUVBQWEsQ0FBQTtBQUNkLENBQUMsRUFKSSxtQkFBbUIsS0FBbkIsbUJBQW1CLFFBSXZCO0FBZ0NELElBQUssd0JBRUo7QUFGRCxXQUFLLHdCQUF3QjtJQUM1QiwyRUFBK0MsQ0FBQTtBQUNoRCxDQUFDLEVBRkksd0JBQXdCLEtBQXhCLHdCQUF3QixRQUU1QjtBQUVELElBQUsseUJBRUo7QUFGRCxXQUFLLHlCQUF5QjtJQUM3QiwwREFBNkIsQ0FBQTtBQUM5QixDQUFDLEVBRkkseUJBQXlCLEtBQXpCLHlCQUF5QixRQUU3QjtBQW1GRCxDQUFDO0FBQ0QsQ0FBQztBQTRCRCxTQUFTLGVBQWUsQ0FBQyxPQUFhLEVBQUUsS0FBVyxFQUFFLFdBQWdCO0lBQ2pFLElBQUksR0FBRyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUM7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RTtxQkFBTTtvQkFDSCxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsV0FBVyxDQUFDLEdBQUMsR0FBRyxDQUFDO2lCQUNuQzthQUNKO2lCQUFNO2dCQUNILEdBQUcsQ0FBQyxLQUFLLENBQUMsaUJBQWlCLENBQUMsQ0FBQzthQUNoQztTQUNKO0tBQ0o7SUFBQyxPQUFPLENBQUMsRUFBRTtRQUNSLEdBQUcsQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3hCLE9BQU8saUJBQWlCLENBQUM7S0FDNUI7SUFDRCxPQUFPLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUN2QyxDQUFDO0FBS0QsU0FBUyxZQUFZLENBQUMsT0FBYSxFQUFFLEtBQVcsRUFBRSxXQUFnQjtJQUM5RCxJQUFJLEdBQUcsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDO0lBRXRCLElBQUk7UUFDQSxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsV0FBVyxDQUFDLEdBQUksVUFBVSxDQUFDO1FBQzFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxZQUFZLENBQUMsR0FBSSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksSUFBSSxFQUFFLEdBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUQsT0FBTyxTQUFTLENBQUM7S0FDcEI7SUFBQyxPQUFPLENBQUMsRUFBRTtRQUNSLEdBQUcsQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3hCLE9BQU8saUJBQWlCLENBQUM7S0FDNUI7QUFDTCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy9pbnRlcmZhY2UgZGVmaW5pdGlvblxuXG5pbnRlcmZhY2UgTGVnIHtcbiAgYWRkcmVzcyA6IHN0cmluZztcbiAgbmFtZSA6IHN0cmluZ1xufVxuaW50ZXJmYWNlIENhbGwge1xuICBzdGF0ZSA6IG51bWJlclxufVxuXG5lbnVtIENhcGFiaWxpdGllcyB7XG4gIFJFTDFYWCA9IFwiUkVMMVhYXCIsXG4gIEZPUktJTkc9IFwiRk9SS0lOR1wiLFxuICBQUkVDT05ESVRJT049XCJQUkVDT05ESVRJT05cIixcbiAgUEVNPVwiUEVNXCIsXG4gIFVQREFURT1cIlVQREFURVwiXG59XG5cbmludGVyZmFjZSBNZXNzYWdlIHtcbiAgbWV0aG9kIDogW3N0cmluZ107XG4gIHR5cGUgOiBbc3RyaW5nXTtcbiAgYm9keSA6IFtzdHJpbmddXG59XG5cbmludGVyZmFjZSBTSVAge1xuICBjYXBhYmlsaXRpZXMgOiBbQ2FwYWJpbGl0aWVzXTtcbiAgbWVzc2FnZSA6IE1lc3NhZ2Vcbn1cblxuaW50ZXJmYWNlIENhbGxTdGFydCB7XG4gIGNvbnRhY3QgOiBzdHJpbmc7XG4gIGNhdXNlOiBzdHJpbmc7XG4gIGxlZyA6IHN0cmluZ1xufVxuXG5pbnRlcmZhY2UgQ2FsbFBvbGwge1xuICBuYW1lOiBzdHJpbmc7XG4gIHR5cGU6IHN0cmluZztcbiAgbGVnOiBzdHJpbmdcbn1cblxuaW50ZXJmYWNlIEV2ZW50IHtcbiAgbmFtZSA6IHN0cmluZztcbiAgY2FsbFN0YXJ0PyA6IENhbGxTdGFydDtcbiAgY2FsbFBvbGw/IDogQ2FsbFBvbGxcbn1cblxuXG5pbnRlcmZhY2UgT0NDUEV2ZW50IHtcbiAgY2FsbGlkIDogc3RyaW5nO1xuICBjYWxsIDogQ2FsbDtcbiAgYXMgOiBzdHJpbmc7XG4gIGV2ZW50dGltZSA6IG51bWJlcjtcbiAgU0lQIDogU0lQO1xuICBldmVudDogRXZlbnRcbn1cblxuaW50ZXJmYWNlIEV2ZW50cyB7XG4gIFN1Y2Nlc3NSZXNwb25zZVBvbGxFdmVudD8gOiBzdHJpbmc7XG4gIFJhd0NvbnRlbnRQb2xsRXZlbnQ/IDogc3RyaW5nO1xuICBJbmZvUG9sbEV2ZW50Pzogc3RyaW5nXG59XG4vKipcbiAgRGVmaW5lIGhlYWRlciB2YXJpYWJsZXMgdXNlZCBieSBhcHBsaWNhdGlvblxuKi9cbmludGVyZmFjZSBIZWFkZXJWYXJzIHtcbiAgZGlzYWJsZVNlbmREZWZhdWx0UmVhc29uPyA6IHN0cmluZztcbiAgZGlzYWJsZVNlbmROb0Fuc3dlclJlYXNvbj8gOiBzdHJpbmdcbn1cblxuZW51bSBBbm5vdHlwZSB7XG4gIENPTk5FQ1QgPSBcIkNPTk5FQ1RcIixcbiAgUklOR0lORyA9IFwiUklOR1wiXG59XG5cbmludGVyZmFjZSBSaW5naW5nVG9uZSB7XG4gIGFubm9fbmFtZSA6IHN0cmluZztcbiAgYW5ub190eXBlIDogQW5ub3R5cGVcbn1cblxuaW50ZXJmYWNlIFNlc3Npb24ge1xuICBsb2cgOiBhbnk7XG4gIGluQ2FwYWJpbGl0aWVzIDogW0NhcGFiaWxpdGllc107XG4gIG91dENhcGFiaWxpdGllcz8gOiBzdHJpbmc7XG4gIGV2ZW50cz8gOiBzdHJpbmc7XG4gIGhlYWRlcnJ1bGV2YXI/IDogc3RyaW5nO1xuICBoZWFkZXJydWxlc3NlbGVjdD8gOiBzdHJpbmc7XG4gIHJpbmdpbmd0b25lcz8gOiBzdHJpbmc7XG4gIHNlbmRBY3Rpb24/IDogc3RyaW5nIDtcbiAgU0lQSGVscGVyIDogYW55O1xuICBTSVBJbml0aWFsSW52aXRlPyA6IGFueTtcbiAgU0lQTWVzc2FnZT8gOiBhbnk7XG4gIFNJUE1lc3NhZ2VUeXBlPyA6IGFueVxufVxuXG5cbmVudW0gQ2FsbFBvbGxBY3Rpb25UeXBlIHtcbiBBY2NlcHQgPSBcImFjY2VwdFwiLFxuIEZvcndhcmQgPSBcImZvcndhcmRcIixcbiBSZWplY3QgPSBcInJlamVjdFwiLFxufVxuXG5lbnVtIENhbGxTdGFydEFjdGlvblR5cGUge1xuIEFib3J0ID0gMCxcbiBGb3J3YXJkID0gMSxcbiBSZWplY3RNcmYgPSAyXG59XG5cblxuXG4vKipcbiBTZXQgYWN0aW9uIGZvciBDYWxsU3RhcnQgZXZlbnRcbiovXG5pbnRlcmZhY2UgQ2FsbFN0YXJ0QWN0aW9uIHtcbiB0eXBlIDogQ2FsbFN0YXJ0QWN0aW9uVHlwZTtcbiBlcnJvcmNvZGUgOiBudW1iZXI7XG4gY2F1c2UgOiBzdHJpbmcgO1xuIHVyaSA6IHN0cmluZztcbiBlYXJseW1lZGlhIDogbnVtYmVyO1xuIGxlZ25hbWUgOiBzdHJpbmcgXG59XG5cbi8qKlxuIFNldCBhY3Rpb24gZm9yIENhbGxQb2xsIGV2ZW50XG4qL1xuaW50ZXJmYWNlIENhbGxQb2xsQWN0aW9uIHtcbiB0eXBlIDogQ2FsbFBvbGxBY3Rpb25UeXBlXG59XG5cblxuLyoqXG4gQXBwbGljYXRpb24gY2FuIHNldCBhY3Rpb24gZm9yIGEgc3BlY2lmaWMgbGVnLCB0aGlzIGlzIGFwcGxpY2FibGUgZm9yIE1SRiBjb250YWN0XG4gKi9cbmludGVyZmFjZSBMZWdBY3Rpb24ge1xuIHR5cGUgOiBDYWxsU3RhcnRBY3Rpb25UeXBlIDtcbiBsZWdhY3Rpb24gOiBzdHJpbmdcbn1cblxuZW51bSBNZWRpYU9wZXJhdGlvbkFjdGlvblR5cGUge1xuIFBlcmZvcm1NZWRpYU9wZXJhdGlvbiA9IFwicGVyZm9ybU1lZGlhT3BlcmF0aW9uXCJcbn1cblxuZW51bSBNZWRpYU9wZXJhdGlvbkNvbnRlbnRUeXBlIHtcbiBNU01MID0gXCJhcHBsaWNhdGlvbi9tc21sK3htbFwiXG59XG5cbmludGVyZmFjZSBQZXJmb3JtTWVkaWFPcGVyYXRpb24ge1xuIENvbnRlbnRUeXBlIDogTWVkaWFPcGVyYXRpb25Db250ZW50VHlwZTtcbiBDb250ZW50IDogc3RyaW5nXG59XG5cbmludGVyZmFjZSBNZWRpYU9wZXJhdGlvbkFjdGlvbiB7XG4gdHlwZSA6IG51bWJlcjtcbiBsZWdhY3Rpb24gOiBNZWRpYU9wZXJhdGlvbkFjdGlvblR5cGU7XG4gcGVyZm9ybU1lZGlhT3BlcmF0aW9uIDogUGVyZm9ybU1lZGlhT3BlcmF0aW9uXG59XG5cbmludGVyZmFjZSBBY3Rpb24ge1xuIGFjdGlvbiA6IGFueSBcbn1cblxuXG5pbnRlcmZhY2UgSGVhZGVyIHtcbiBoZWFkZXIgOiBzdHJpbmc7XG4gdmFsdWUgOiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBRSGVhZGVyIHtcbiBQcml2YWN5IDogc3RyaW5nO1xuIFJlYXNvbiA6IHN0cmluZyA7XG59XG5cbmludGVyZmFjZSBQYXJhbWV0ZXIge1xuIHRyYW5zcG9ydCA6IHN0cmluZztcbiB1c2VyIDogc3RyaW5nIDtcbn1cblxuaW50ZXJmYWNlIFVSSSB7XG4gc2NoZW1lIDogc3RyaW5nO1xuIGF1dGhvcml0eSA6IHN0cmluZyA7XG4gZ3IgOiBzdHJpbmcgO1xuIGhvc3Q6IHN0cmluZyA7XG4gbHIgOiBzdHJpbmcgO1xuIG1hZGRyIDogc3RyaW5nIDtcbiBwb3J0IDogbnVtYmVyICA7XG4gdXNlciA6IHN0cmluZyA7XG4gcGFyYW1ldGVycyA6IFtQYXJhbWV0ZXJdO1xuIHFoZWFkZXIgOiBbUUhlYWRlcl07XG59XG5cbmludGVyZmFjZSBBZGRyZXNzIHtcbiBkaXNwbGF5TmFtZSA6IHN0cmluZztcbiB1cmkgOiBVUkkgXG59XG5cbmludGVyZmFjZSBIaXN0b3J5SW5mbyBpbXBsZW1lbnRzIEhlYWRlciB7XG4gYWRkcmVzcyA6IEFkZHJlc3M7XG4gaW5kZXggOiBzdHJpbmdcbn1cblxuaW50ZXJmYWNlIFBBSSBpbXBsZW1lbnRzIEhlYWRlciAge1xuIGFkZHJlc3MgOiBBZGRyZXNzXG59XG5cbmludGVyZmFjZSBGcm9tIGltcGxlbWVudHMgSGVhZGVyIHtcbiBhZGRyZXNzIDogQWRkcmVzcztcbiB0YWcgOiBzdHJpbmcgO1xufVxuXG5pbnRlcmZhY2UgVG8gaW1wbGVtZW50cyBIZWFkZXIge1xuIGFkZHJlc3MgOiBBZGRyZXNzO1xuIHRhZyA6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIFBDViBpbXBsZW1lbnRzIEhlYWRlciB7XG4gaWNpZF9nZW5lcmF0ZWRfYXQ6IHN0cmluZyA7XG4gaWNpZF92YWx1ZSA6IHN0cmluZyA7XG4gb2FpZCA6IHN0cmluZztcbiB0YWlkIDogc3RyaW5nO1xuIG9zaWQgOiBzdHJpbmc7XG4gdHNpZCA6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIFJlc3VsdENvZGUge1xuICByZXN1bHRDb2RlIDogc3RyaW5nIDtcbn1cblxuOy8vTUFJTkJMT0NLXG47XHJcbi8qXHJcbi8vY29uZmlnIGlzIFwibXJmX2Fubm91bmNlbWVudHNcIlxyXG57XHJcbiAgXCJhbm5vVGVzdFwiOiB7XHJcbiAgICBcIm1heHRpbWVcIjogMTUwMCxcclxuICAgIFwicGF0aFwiOiBcImZpbGU6Ly8vdG1wL2Fubm9zL1wiLFxyXG4gICAgXCJ2YXJpYWJsZVwiOiBcIlwiLFxyXG4gICAgXCJiYXJnZVwiOiAxLFxyXG4gICAgXCJwcm9tcHRcIjogXCJ0ZXN0QW5uby53YXZcIixcclxuICAgIFwiZHRtZlwiOiB7XHJcbiAgICAgIFwiY2xlYXJkYlwiOiAxLFxyXG4gICAgICBcImlkdFwiOiAxLFxyXG4gICAgICBcImZkdFwiOiAxLFxyXG4gICAgICBcIm1pblwiOiAxLFxyXG4gICAgICBcIm1heFwiOiAxLFxyXG4gICAgICBcInJ0ZlwiOiBcIipcIixcclxuICAgICAgXCJjYW5jZWxcIjogXCIjXCJcclxuICAgIH0sXHJcbiAgICBcImFubmlkXCI6IFwiYW5ub1Byb21wdENvbGxlY3RcIixcclxuICAgIFwiaW50ZXJ2YWxcIjogMTAwLFxyXG4gICAgXCJpdGVyYXRlXCI6IDEsXHJcbiAgICBcImNsZWFyZGJcIjogMVxyXG4gIH0sXHJcbn1cclxuXHJcbiovXHJcblxyXG5mdW5jdGlvbiBpbnB1dHZhbGlkYXRpb24oc2Vzc2lvbiA6IGFueSwgZXZlbnQgOiBhbnksIGxvY2FsUGFyYW1zOiBhbnkgKXtcclxuICAgIGxldCBsb2cgPSBzZXNzaW9uLmxvZztcclxuXHJcbiAgICB0cnkge1xyXG5cclxuICAgICAgICAvL3NpcCBpbnZpdGUgaXMgaW4gI3Nlc3Npb25bXCJzX1NJUEludml0ZVwiXVxyXG4gICAgICAgIGlmICggc2Vzc2lvbltcInNfU0lQSW52aXRlXCJdICE9IG51bGwgKSB7XHJcbiAgICAgICAgICAgIGlmKCBzZXNzaW9uW1wic19TSVBJbnZpdGVcIl1bXCJldmVudC10eXBlXCJdIT09bnVsbCAmJiAoc2Vzc2lvbltcInNfU0lQSW52aXRlXCJdW1wiZXZlbnQtdHlwZVwiXT09PVwic2lwXCIgfHwgc2Vzc2lvbltcInNfU0lQSW52aXRlXCJdW1wiZXZlbnQtdHlwZVwiXT09PVwib2NjcFwiKSkge1xyXG4gICAgICAgICAgICAgICAgaWYoIHNlc3Npb25bXCJzX1NJUEludml0ZVwiXVtcImV2ZW50LW5hbWVcIl0hPT1udWxsICYmIHNlc3Npb25bXCJzX1NJUEludml0ZVwiXVtcImV2ZW50LW5hbWVcIl0gPT09IFwic2lwLmNhbGxTdGFydC5OT05FXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnKFwiZ290IHNpcCBpbnZpdGVcIik7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiZXJyb3IuaW5wdXQuc2lwaW52aXRlaW5jb3JyZWN0ZXZlbnRuYW1lXCI7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJlcnJvci5pbnB1dC5zaXBpbnZpdGVpbmNvcnJlY3RldmVudHR5cGVcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBcImVycm9yLmlucHV0LnNpcGludml0ZW1pc3NpbmdcIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vYW5ub3VuY2VtZW50IHN0cmluZ1xyXG4gICAgICAgIGlmICggZXZlbnRbXCJhbm5vdW5jZW1lbnRcIl0gIT0gbnVsbCApIHtcclxuICAgICAgICAgICAgbG9nLmRlYnVnKFwiYW5ub3VuY2VtZW50OiB7fVwiLCBldmVudFtcImFubm91bmNlbWVudFwiXSk7XHJcbiAgICAgICAgICAgICAgICBzZXNzaW9uW1wibXJmXCJdW1wiYW5ub3VuY2VtZW50XCJdID0gZXZlbnRbXCJhbm5vdW5jZW1lbnRcIl07ICAgICAgICAgICBcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gXCJlcnJvci5pbnB1dC5hY3Rpb25taXNzaW5nXCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL3Byb21wdGFuZGNvbGxlY3QsIHBsYXlhbm5vdW5jZW1lbnRcclxuICAgICAgICBpZiAoIChldmVudFtcImFjdGlvblwiXSAhPSBudWxsKSAmJiAoKGV2ZW50W1wiYWN0aW9uXCJdPT09XCJwcm9tcHRhbmRjb2xsZWN0XCIpIHx8IChldmVudFtcImFjdGlvblwiXT09PVwicGxheWFubm91bmNlbWVudFwiKSkgKSB7XHJcbiAgICAgICAgICAgIGxvZy5kZWJ1ZyhcImFjdGlvbjoge31cIiwgZXZlbnRbXCJhY3Rpb25cIl0pO1xyXG4gICAgICAgICAgICBpZiAoIGV2ZW50W1wiYWN0aW9uXCJdPT09XCJwcm9tcHRhbmRjb2xsZWN0XCIgKSBcclxuICAgICAgICAgICAgICAgIHNlc3Npb25bXCJtcmZcIl1bXCJhY3Rpb25cIl0gPSBcInByb21wdGFuZGNvbGxlY3RcIjtcclxuICAgICAgICAgICAgZWxzZSBpZiAoIGV2ZW50W1wiYWN0aW9uXCJdPT09XCJwbGF5YW5ub3VuY2VtZW50XCIgKSBcclxuICAgICAgICAgICAgICAgIHNlc3Npb25bXCJtcmZcIl1bXCJhY3Rpb25cIl0gPSBcInBsYXlhbm5vdW5jZW1lbnRcIjtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiZXJyb3IuaW5wdXQuYWN0aW9uaW5jb3JyZWN0XCI7ICAgICAgICAgICAgXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIFwiZXJyb3IuaW5wdXQuYWN0aW9ubWlzc2luZ1wiO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy9lYXJseSBkaWFsb2cgaXMgYm9vbGVhbiB0cnVlL2ZhbHNlXHJcbiAgICAgICAgaWYgKCBldmVudFtcImVhcmx5ZGlhbG9nXCJdICE9IG51bGwgKSB7XHJcbiAgICAgICAgICAgIGxvZy5kZWJ1ZyhcImVhcmx5ZGlhbG9nOiB7fVwiLCBldmVudFtcImVhcmx5ZGlhbG9nXCJdKTtcclxuICAgICAgICAgICAgaWYgKCBldmVudFtcImVhcmx5ZGlhbG9nXCJdID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBzZXNzaW9uW1wibXJmXCJdW1wiZWFybHlkaWFsb2dcIl0gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFwidHJ1ZVwiO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKCBldmVudFtcImVhcmx5ZGlhbG9nXCJdID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgc2Vzc2lvbltcIm1yZlwiXVtcImVhcmx5ZGlhbG9nXCJdID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJmYWxzZVwiO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiZXJyb3IuaW5wdXQuZWFybHlkaWFsb2dpbmNvcnJlY3RcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBcImVycm9yLmlucHV0LmVhcmx5ZGlhbG9nXCI7XHJcbiAgICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIGxvZy5kZWJ1ZyhcIkxvZzoge31cIiwgZSk7XHJcbiAgICAgICAgcmV0dXJuIFwiZXJyb3IuZXhjZXB0aW9uXCI7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZTIwME9LSU5WSVRFKHNlc3Npb246YW55LGV2ZW50Ok9DQ1BTSVAuT0NDUEV2ZW50LGxvY2FsUGFyYW1zOmFueSkge1xyXG4gICAgbGV0IGxvZyA9IHNlc3Npb24ubG9nO1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgICAgLy90aGUgcmVjZWl2ZWQgZXZlbnQgaXMgbm93IGluIGxvY2FsUGFyYW1zXHJcbiAgICAgICAgbGV0IGV2ZW50RGF0YSA9IGxvY2FsUGFyYW1zLm1lc3NhZ2U7XHJcbiAgICAgICAgLy9zZXNzaW9uLmV2ZW50cyA9IG51bGw7XHJcbiAgICAgICAgc2Vzc2lvbltcIm1yZlwiXVtcImhlYWRlcnJ1bGV2YXI9bnVsbFwiXTtcclxuICAgICAgICBzZXNzaW9uW1wibXJmXCJdW1wiaGVhZGVycnVsZXNzZWxlY3RcIl0gPSBudWxsO1xyXG4gICAgICAgIHNlc3Npb25bXCJtcmZcIl1bXCJyaW5naW5ndG9uZXNcIl0gPSBudWxsO1xyXG5cclxuICAgICAgICBsZXQgcG9sbEFjdGlvbiA6IENhbGxQb2xsQWN0aW9uO1xyXG4gICAgICAgIHBvbGxBY3Rpb24gPSBwb2xsQWN0aW9uIHx8IHt9O1xyXG4gICAgICAgIHBvbGxBY3Rpb24udHlwZSA9IENhbGxQb2xsQWN0aW9uVHlwZS5BY2NlcHQ7XHJcbiAgICAgICAgc2Vzc2lvbltcIm1yZlwiXVtcInNlbmRBY3Rpb25cIl0gPSBKU09OLnN0cmluZ2lmeShwb2xsQWN0aW9uKTtcclxuXHJcbiAgICAgICAgc2Vzc2lvbltcIm1yZlwiXVtcInRpbWUyMDBPS0lOVklURVwiXSAgPSBNYXRoLmZsb29yKG5ldyBEYXRlKCkvMTAwMCk7XHJcblxyXG4gICAgICAgIC8vc2F2ZSB0byB0YWdcclxuICAgICAgICBsZXQgdG8gOiBUbyA9IGV2ZW50RGF0YS5TSVAuVG87XHJcbiAgICAgICAgaWYoIHRvIT1udWxsKSB7XHJcbiAgICAgICAgICAgIGxvZy5kZWJ1ZyhcInJlY2VpdmVkIGZyb20gTVJGIHRvIHRhZzp7fVwiLHRvKTtcclxuICAgICAgICAgICAgc2Vzc2lvbltcIm1yZlwiXVtcImNhbGxzdGF0ZVwiXSAgPSBcIk1SRkNPTk5FQ1RFRDIwME9LXCI7XHJcbiAgICAgICAgICAgIHNlc3Npb25bXCJtcmZcIl1bXCJkb3duU3RyZWFtVG9UYWdcIl09dG8udGFnO1xyXG4gICAgICAgICAgICByZXR1cm4gXCJzdWNjZXNzXCI7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbG9nLmRlYnVnKFwicmVjZWl2ZWQgZnJvbSBNUkYgbm8gdG8gdGFnOnt9XCIsdG8pO1xyXG4gICAgICAgICAgICByZXR1cm4gXCJlcnJvci5ub3RvdGFnXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIGxvZy5kZWJ1ZyhcIkxvZzoge31cIiwgZSk7XHJcbiAgICAgICAgcmV0dXJuIFwiZXJyb3IuZXhjZXB0aW9uXCI7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZTIwME9LSU5GTyhzZXNzaW9uOmFueSxldmVudDpPQ0NQU0lQLkV2ZW50LGxvY2FsUGFyYW1zOkxvY2FsUGFyYW1ldGVycyk6IGFueXtcclxuICAgIGxldCBsb2cgPSBzZXNzaW9uLmxvZztcclxuXHJcbiAgICB0cnkgeyAgICAgICAgXHJcbiAgICAgICAgc2Vzc2lvbltcIm1yZlwiXVtcInRpbWUyMDBPS0lORk9cIl0gID0gTWF0aC5mbG9vcihuZXcgRGF0ZSgpLzEwMDApO1xyXG4gICAgICAgIHNlc3Npb25bXCJtcmZcIl1bXCJjYWxsc3RhdGVcIl0gID0gXCJNUkZDT05ORUNURURcIjtcclxuICAgICAgICBpZiAoZXZlbnQuU0lQLmNvbnRlbnQuanNvbi5tc21sLmV2ZW50Lm5hbWVbMl0hPW51bGwpIHtcclxuICAgICAgICAgICAgaWYgKGV2ZW50LlNJUC5jb250ZW50Lmpzb24ubXNtbC5ldmVudC5uYW1lWzJdPT1cImR0bWYuZGlnaXRzXCIpIHtcclxuICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyhcIkdvdCBEVE1GIGRpZ2l0cztcIik7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuU0lQLmNvbnRlbnQuanNvbi5tc21sLmV2ZW50LnZhbHVlWzFdIT1udWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbltcIm1yZlwiXVtcImR0bWZkaWdpdFwiXT1ldmVudC5TSVAuY29udGVudC5qc29uLm1zbWwuZXZlbnQudmFsdWVbMV07ICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uW1wibXJmXCJdW1wiZHRtZmRpZ2l0XCJdPVwiMFwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbG9nLmRlYnVnKFwiTm8gRFRNRiBkaWdpdHM7XCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIGxvZy5kZWJ1ZyhcIkxvZzoge31cIiwgZSk7XHJcbiAgICAgICAgcmV0dXJuIFwiZXJyb3IuZXhjZXB0aW9uXCI7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc2Vzc2lvbltcIm1yZlwiXVtcImR0bWZkaWdpdFwiXTtcclxufVxyXG5cclxuXHJcblxyXG5cclxuZnVuY3Rpb24gY2FsbEFuc3dlcmVkKHNlc3Npb24gOiBhbnksIGV2ZW50IDogYW55LCBsb2NhbFBhcmFtczogYW55ICl7XHJcbiAgICBsZXQgbG9nID0gc2Vzc2lvbi5sb2c7XHJcblxyXG4gICAgdHJ5IHsgICAgICAgIFxyXG4gICAgICAgIHNlc3Npb25bXCJtcmZcIl1bXCJjYWxsc3RhdGVcIl0gID0gXCJBTlNXRVJFRFwiO1xyXG4gICAgICAgIHNlc3Npb25bXCJtcmZcIl1bXCJhbnN3ZXJ0aW1lXCJdICA9IE1hdGguZmxvb3IobmV3IERhdGUoKS8xMDAwKTtcclxuICAgICAgICByZXR1cm4gXCJzdWNjZXNzXCI7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgbG9nLmRlYnVnKFwiTG9nOiB7fVwiLCBlKTtcclxuICAgICAgICByZXR1cm4gXCJlcnJvci5leGNlcHRpb25cIjtcclxuICAgIH1cclxufVxyXG5cclxuXHJcblxyXG5cclxuIl19