"use strict";
var Capabilities;
(function (Capabilities) {
    Capabilities["REL1XX"] = "REL1XX";
    Capabilities["FORKING"] = "FORKING";
    Capabilities["PRECONDITION"] = "PRECONDITION";
    Capabilities["PEM"] = "PEM";
    Capabilities["UPDATE"] = "UPDATE";
})(Capabilities || (Capabilities = {}));
var Annotype;
(function (Annotype) {
    Annotype["CONNECT"] = "CONNECT";
    Annotype["RINGING"] = "RING";
})(Annotype || (Annotype = {}));
var CallPollActionType;
(function (CallPollActionType) {
    CallPollActionType["Accept"] = "accept";
    CallPollActionType["Forward"] = "forward";
    CallPollActionType["Reject"] = "reject";
})(CallPollActionType || (CallPollActionType = {}));
var CallStartActionType;
(function (CallStartActionType) {
    CallStartActionType[CallStartActionType["Abort"] = 0] = "Abort";
    CallStartActionType[CallStartActionType["Forward"] = 1] = "Forward";
    CallStartActionType[CallStartActionType["RejectMrf"] = 2] = "RejectMrf";
})(CallStartActionType || (CallStartActionType = {}));
var MediaOperationActionType;
(function (MediaOperationActionType) {
    MediaOperationActionType["PerformMediaOperation"] = "performMediaOperation";
})(MediaOperationActionType || (MediaOperationActionType = {}));
var MediaOperationContentType;
(function (MediaOperationContentType) {
    MediaOperationContentType["MSML"] = "application/msml+xml";
})(MediaOperationContentType || (MediaOperationContentType = {}));
;
;
function SendINFOPromptandCollect(session, event, localParams) {
    var outevent = {
        "callid": session["fsm-id"],
        "event-type": "sip",
        "queue": "TASV4_1",
        "id": 2,
        "action": {
            "legaction": "performMediaOperation",
            "performMediaOperation": {
                "ContentType": "application/msml+xml",
                "Content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<msml  version=\"1.1\">\n<dialogstart name=\"annoPromptCollect\" target=\"conn:\"session[",
                mrf: mrf,
                "][": downStreamToTag, "] type=\"application/moml+xml\">\n<play interval=\"100ms\" iterate=\"1\" cleardb=\"true\" maxtime=\"50000ms\" barge=\"true\">\n <audio uri=\"file:///appl/wav/simpleplay.wav\"/>\n <playexit>\n   <exit namelist=\"play.end play.amt\"/>\n </playexit>\n</play>\n</dialogstart>\n</msml>": 
            },
            "type": 3
        },
        "event-name": "sip.media.playAnnouncement",
        "eventname": "callEarlyAnswered",
        "session": session["fsm-id"]
    };
    return outevent;
}
function inputvalidation(session, event, localParams) {
    var log = session.log;
    try {
        if (session["s_SIPInvite"] != null) {
            if (session["s_SIPInvite"]["event-type"] !== null && (session["s_SIPInvite"]["event-type"] === "sip" || session["s_SIPInvite"]["event-type"] === "occp")) {
                if (session["s_SIPInvite"]["event-name"] !== null && session["s_SIPInvite"]["event-name"] === "sip.callStart.NONE")
                    log.debug("got sip invite");
                else
                    return "error.input.sipinviteincorrecteventname";
            }
            else {
                return "error.input.sipinviteincorrecteventtype";
            }
        }
        else {
            return "error.input.sipinvitemissing";
        }
        return "true";
        if (event["announcement"] != null) {
            log.debug("announcement: {}", event["announcement"]);
            session["mrf"]["announcement"] = event["announcement"];
        }
        else {
            return "error.input.actionmissing";
        }
        if ((event["action"] != null) && ((event["action"] === "promptandcollect") || (event["action"] === "playannouncement"))) {
            log.debug("action: {}", event["action"]);
            if (event["action"] === "promptandcollect")
                session["mrf"]["action"] = "promptandcollect";
            else if (event["action"] === "playannouncement")
                session["mrf"]["action"] = "playannouncement";
            else
                return "error.input.actionincorrect";
        }
        else {
            return "error.input.actionmissing";
        }
        if (event["earlydialog"] != null) {
            log.debug("earlydialog: {}", event["earlydialog"]);
            if (event["earlydialog"] === true) {
                session["mrf"]["earlydialog"] = true;
                return "true";
            }
            else if (event["earlydialog"] === false) {
                session["mrf"]["earlydialog"] = false;
                return "false";
            }
            else {
                return "error.input.earlydialogincorrect";
            }
        }
        else {
            return "error.input.earlydialog";
        }
    }
    catch (e) {
        log.debug("Log: {}", e);
        return "error.exception";
    }
}
function armMRFevents(sessionData, eventData, localParams) {
    var ret;
    var status2;
    var events;
    events = events || {};
    events.InfoPollEvent = "null";
    events.SuccessResponsePollEvent = "null";
    events.RawContentPollEvent = "test/test";
    var headerVars;
    headerVars = headerVars || {};
    headerVars.disableSendDefaultReason = "Disabled";
    headerVars.disableSendNoAnswerReason = "Disabled";
    var ringingTones;
    ringingTones = ringingTones || [];
    var comf;
    comf = comf || {};
    comf.anno_name = "comfort";
    comf.anno_type = Annotype.CONNECT;
    var ring;
    ring = ring || {};
    ring.anno_name = "ringing";
    ring.anno_type = Annotype.RINGING;
    ringingTones.push(comf, ring);
    var capabilities = sessionData.inCapabilities;
    if (capabilities != null) {
        capabilities.push(Capabilities.PEM);
        capabilities.push(Capabilities.FORKING);
        capabilities.push(Capabilities.UPDATE);
        capabilities.push(Capabilities.INFO);
        sessionData.outCapabilities = JSON.stringify(capabilities);
    }
    sessionData.events = JSON.stringify(events);
    sessionData.headerrulevar = JSON.stringify(headerVars);
    sessionData.headerrulesselect = "SipServiceSpecificRulesSet";
    sessionData.ringingtones = JSON.stringify(ringingTones);
    sessionData.upstreamCapabilities = JSON.stringify([]);
    return "success";
}
function handle200OKINVITE(session, event, localParams) {
    var log = session.log;
    try {
        var eventData = localParams.message;
        session["mrf"]["headerrulevar=null"];
        session["mrf"]["headerrulesselect"] = null;
        session["mrf"]["ringingtones"] = null;
        var pollAction = void 0;
        pollAction = pollAction || {};
        pollAction.type = CallPollActionType.Accept;
        session.sendAction = JSON.stringify(pollAction);
        session["mrf"]["time200OKINVITE"] = Math.floor(new Date() / 1000);
        var to = eventData.SIP.To;
        if (to != null) {
            log.debug("received from MRF to tag:{}", to);
            session["mrf"]["callstate"] = "MRFCONNECTED200OK";
            session["mrf"]["downStreamToTag"] = to.tag;
            return "success";
        }
        else {
            log.debug("received from MRF no to tag:{}", to);
            return "error.nototag";
        }
    }
    catch (e) {
        log.debug("handle200OKINVITE Log: {}", e);
        return "error.exception";
    }
}
function handle200OKINFO(session, event, localParams) {
    var log = session.log;
    try {
        session["mrf"]["time200OKINFO"] = Math.floor(new Date() / 1000);
        session["mrf"]["callstate"] = "MRFCONNECTED";
        if (event.SIP.content.json.msml.event.name[2] != null) {
            if (event.SIP.content.json.msml.event.name[2] == "dtmf.digits") {
                log.debug("Got DTMF digits;");
                if (event.SIP.content.json.msml.event.value[1] != null) {
                    session["mrf"]["dtmfdigit"] = event.SIP.content.json.msml.event.value[1];
                }
                else {
                    session["mrf"]["dtmfdigit"] = "0";
                }
            }
            else {
                log.debug("No DTMF digits;");
            }
        }
    }
    catch (e) {
        log.debug("Log: {}", e);
        return "error.exception";
    }
    return session["mrf"]["dtmfdigit"];
}
function callAnswered(session, event, localParams) {
    var log = session.log;
    try {
        session["mrf"]["callstate"] = "ANSWERED";
        session["mrf"]["answertime"] = Math.floor(new Date() / 1000);
        return "success";
    }
    catch (e) {
        log.debug("Log: {}", e);
        return "error.exception";
    }
}
function checkDisconnectReason(session, event, localParams) {
    var log = session.log;
    try {
        session["mrf"]["callstate"] = "ConnectError";
        session["mrf"]["connecterrortime"] = Math.floor(new Date() / 1000);
        var eventsStack = event['events-stack'];
        if (eventsStack != null && eventsStack.size() > 0) {
            for (var i = eventsStack.size() - 1; i >= 0; i--) {
                if (eventsStack.get(i).equals("leg.timeout") && i >= (eventsStack.size() - 2)) {
                    session.loginfo = session.loginfo + "TIMEOUT;";
                    return "error.mrf.connect.timeout";
                }
            }
        }
    }
    catch (e) {
        log.debug("Log: {}", e);
        return "error.mrf.connect.exception";
    }
    return "error.mrf.connect.others";
}
function setrelease(session, event, localParams) {
    var log = session.log;
    try {
        session["mrf"]["callstate"] = "Released";
        session["mrf"]["releasetime"] = Math.floor(new Date() / 1000);
        return "success";
    }
    catch (e) {
        log.debug("Log: {}", e);
        return "error.release";
    }
}
function prepareCallRouting(session, eventData, localParams) {
    var ret;
    ret = ret || {};
    ret.resultCode = "success";
    var status2;
    var events;
    events = events || {};
    events.InfoPollEvent = "null";
    events.SuccessResponsePollEvent = "null";
    events.RawContentPollEvent = "test/test";
    var headerVars;
    headerVars = headerVars || {};
    headerVars.disableSendDefaultReason = "Disabled";
    headerVars.disableSendNoAnswerReason = "Disabled";
    var ringingTones;
    ringingTones = ringingTones || [];
    var comf;
    comf = comf || {};
    comf.anno_name = "comfort";
    comf.anno_type = Annotype.CONNECT;
    var ring;
    ring = ring || {};
    ring.anno_name = "ringing";
    ring.anno_type = Annotype.RINGING;
    ringingTones.push(comf, ring);
    var capabilities = sessionData.inCapabilities;
    if (capabilities != null) {
        capabilities.push(Capabilities.PEM);
        capabilities.push(Capabilities.FORKING);
        sessionData.outCapabilities = JSON.stringify(capabilities);
    }
    session.events = JSON.stringify(events);
    session.headerrulevar = JSON.stringify(headerVars);
    session.headerrulesselect = "SipServiceSpecificRulesSet";
    session.ringingtones = JSON.stringify(ringingTones);
    session.upstreamCapabilities = JSON.stringify([]);
    status2 = "success";
    return ret;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kdWxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibW9kdWxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFXQSxJQUFLLFlBTUo7QUFORCxXQUFLLFlBQVk7SUFDZixpQ0FBaUIsQ0FBQTtJQUNqQixtQ0FBa0IsQ0FBQTtJQUNsQiw2Q0FBMkIsQ0FBQTtJQUMzQiwyQkFBUyxDQUFBO0lBQ1QsaUNBQWUsQ0FBQTtBQUNqQixDQUFDLEVBTkksWUFBWSxLQUFaLFlBQVksUUFNaEI7QUFzREQsSUFBSyxRQUdKO0FBSEQsV0FBSyxRQUFRO0lBQ1gsK0JBQW1CLENBQUE7SUFDbkIsNEJBQWdCLENBQUE7QUFDbEIsQ0FBQyxFQUhJLFFBQVEsS0FBUixRQUFRLFFBR1o7QUF1QkQsSUFBSyxrQkFJSjtBQUpELFdBQUssa0JBQWtCO0lBQ3RCLHVDQUFpQixDQUFBO0lBQ2pCLHlDQUFtQixDQUFBO0lBQ25CLHVDQUFpQixDQUFBO0FBQ2xCLENBQUMsRUFKSSxrQkFBa0IsS0FBbEIsa0JBQWtCLFFBSXRCO0FBRUQsSUFBSyxtQkFJSjtBQUpELFdBQUssbUJBQW1CO0lBQ3ZCLCtEQUFTLENBQUE7SUFDVCxtRUFBVyxDQUFBO0lBQ1gsdUVBQWEsQ0FBQTtBQUNkLENBQUMsRUFKSSxtQkFBbUIsS0FBbkIsbUJBQW1CLFFBSXZCO0FBZ0NELElBQUssd0JBRUo7QUFGRCxXQUFLLHdCQUF3QjtJQUM1QiwyRUFBK0MsQ0FBQTtBQUNoRCxDQUFDLEVBRkksd0JBQXdCLEtBQXhCLHdCQUF3QixRQUU1QjtBQUVELElBQUsseUJBRUo7QUFGRCxXQUFLLHlCQUF5QjtJQUM3QiwwREFBNkIsQ0FBQTtBQUM5QixDQUFDLEVBRkkseUJBQXlCLEtBQXpCLHlCQUF5QixRQUU3QjtBQW1GRCxDQUFDO0FBQ0QsQ0FBQztBQTJFRCxTQUFTLHdCQUF3QixDQUFDLE9BQWEsRUFBRSxLQUFXLEVBQUUsV0FBZ0I7SUF3QjFFLElBQUksUUFBUSxHQUFHO1FBQ2YsUUFBUSxFQUFFLE9B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Q2hDLElBQUksSUFBa0IsQ0FBQztJQUN2QixJQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztJQUNsQixJQUFJLENBQUMsU0FBUyxHQUFDLFNBQVMsQ0FBQztJQUN6QixJQUFJLENBQUMsU0FBUyxHQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUM7SUFDaEMsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDOUIsSUFBSSxZQUFZLEdBQUcsV0FBVyxDQUFDLGNBQWMsQ0FBQztJQUM5QyxJQUFJLFlBQVksSUFBRSxJQUFJLEVBQUM7UUFDbkIsWUFBWSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDcEMsWUFBWSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDeEMsV0FBVyxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO0tBQzlEO0lBQ0QsT0FBTyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3hDLE9BQU8sQ0FBQyxhQUFhLEdBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUNqRCxPQUFPLENBQUMsaUJBQWlCLEdBQUcsNEJBQTRCLENBQUM7SUFDekQsT0FBTyxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQ3BELE9BQU8sQ0FBQyxvQkFBb0IsR0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2hELE9BQU8sR0FBRyxTQUFTLENBQUM7SUFDcEIsT0FBTyxHQUFHLENBQUM7QUFDZixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiXG4vL2ludGVyZmFjZSBkZWZpbml0aW9uXHJcblxyXG5pbnRlcmZhY2UgTGVnIHtcclxuICBhZGRyZXNzIDogc3RyaW5nO1xyXG4gIG5hbWUgOiBzdHJpbmdcclxufVxyXG5pbnRlcmZhY2UgQ2FsbCB7XHJcbiAgc3RhdGUgOiBudW1iZXJcclxufVxyXG5cclxuZW51bSBDYXBhYmlsaXRpZXMge1xyXG4gIFJFTDFYWCA9IFwiUkVMMVhYXCIsXHJcbiAgRk9SS0lORz0gXCJGT1JLSU5HXCIsXHJcbiAgUFJFQ09ORElUSU9OPVwiUFJFQ09ORElUSU9OXCIsXHJcbiAgUEVNPVwiUEVNXCIsXHJcbiAgVVBEQVRFPVwiVVBEQVRFXCJcclxufVxyXG5cclxuaW50ZXJmYWNlIE1lc3NhZ2Uge1xyXG4gIG1ldGhvZCA6IFtzdHJpbmddO1xyXG4gIHR5cGUgOiBbc3RyaW5nXTtcclxuICBib2R5IDogW3N0cmluZ11cclxufVxyXG5cclxuaW50ZXJmYWNlIFNJUCB7XHJcbiAgY2FwYWJpbGl0aWVzIDogW0NhcGFiaWxpdGllc107XHJcbiAgbWVzc2FnZSA6IE1lc3NhZ2VcclxufVxyXG5cclxuaW50ZXJmYWNlIENhbGxTdGFydCB7XHJcbiAgY29udGFjdCA6IHN0cmluZztcclxuICBjYXVzZTogc3RyaW5nO1xyXG4gIGxlZyA6IHN0cmluZ1xyXG59XHJcblxyXG5pbnRlcmZhY2UgQ2FsbFBvbGwge1xyXG4gIG5hbWU6IHN0cmluZztcclxuICB0eXBlOiBzdHJpbmc7XHJcbiAgbGVnOiBzdHJpbmdcclxufVxyXG5cclxuaW50ZXJmYWNlIEV2ZW50IHtcclxuICBuYW1lIDogc3RyaW5nO1xyXG4gIGNhbGxTdGFydD8gOiBDYWxsU3RhcnQ7XHJcbiAgY2FsbFBvbGw/IDogQ2FsbFBvbGxcclxufVxyXG5cclxuXHJcbmludGVyZmFjZSBPQ0NQRXZlbnQge1xyXG4gIGNhbGxpZCA6IHN0cmluZztcclxuICBjYWxsIDogQ2FsbDtcclxuICBhcyA6IHN0cmluZztcclxuICBldmVudHRpbWUgOiBudW1iZXI7XHJcbiAgU0lQIDogU0lQO1xyXG4gIGV2ZW50OiBFdmVudFxyXG59XHJcblxyXG5pbnRlcmZhY2UgRXZlbnRzIHtcclxuICBTdWNjZXNzUmVzcG9uc2VQb2xsRXZlbnQ/IDogc3RyaW5nO1xyXG4gIFJhd0NvbnRlbnRQb2xsRXZlbnQ/IDogc3RyaW5nO1xyXG4gIEluZm9Qb2xsRXZlbnQ/OiBzdHJpbmdcclxufVxyXG4vKipcclxuICBEZWZpbmUgaGVhZGVyIHZhcmlhYmxlcyB1c2VkIGJ5IGFwcGxpY2F0aW9uXHJcbiovXHJcbmludGVyZmFjZSBIZWFkZXJWYXJzIHtcclxuICBkaXNhYmxlU2VuZERlZmF1bHRSZWFzb24/IDogc3RyaW5nO1xyXG4gIGRpc2FibGVTZW5kTm9BbnN3ZXJSZWFzb24/IDogc3RyaW5nXHJcbn1cclxuXHJcbmVudW0gQW5ub3R5cGUge1xyXG4gIENPTk5FQ1QgPSBcIkNPTk5FQ1RcIixcclxuICBSSU5HSU5HID0gXCJSSU5HXCJcclxufVxyXG5cclxuaW50ZXJmYWNlIFJpbmdpbmdUb25lIHtcclxuICBhbm5vX25hbWUgOiBzdHJpbmc7XHJcbiAgYW5ub190eXBlIDogQW5ub3R5cGVcclxufVxyXG5cclxuaW50ZXJmYWNlIFNlc3Npb24ge1xyXG4gIGxvZyA6IGFueTtcclxuICBpbkNhcGFiaWxpdGllcyA6IFtDYXBhYmlsaXRpZXNdO1xyXG4gIG91dENhcGFiaWxpdGllcz8gOiBzdHJpbmc7XHJcbiAgZXZlbnRzPyA6IHN0cmluZztcclxuICBoZWFkZXJydWxldmFyPyA6IHN0cmluZztcclxuICBoZWFkZXJydWxlc3NlbGVjdD8gOiBzdHJpbmc7XHJcbiAgcmluZ2luZ3RvbmVzPyA6IHN0cmluZztcclxuICBzZW5kQWN0aW9uPyA6IHN0cmluZyA7XHJcbiAgU0lQSGVscGVyIDogYW55O1xyXG4gIFNJUEluaXRpYWxJbnZpdGU/IDogYW55O1xyXG4gIFNJUE1lc3NhZ2U/IDogYW55O1xyXG4gIFNJUE1lc3NhZ2VUeXBlPyA6IGFueVxyXG59XHJcblxyXG5cclxuZW51bSBDYWxsUG9sbEFjdGlvblR5cGUge1xyXG4gQWNjZXB0ID0gXCJhY2NlcHRcIixcclxuIEZvcndhcmQgPSBcImZvcndhcmRcIixcclxuIFJlamVjdCA9IFwicmVqZWN0XCIsXHJcbn1cclxuXHJcbmVudW0gQ2FsbFN0YXJ0QWN0aW9uVHlwZSB7XHJcbiBBYm9ydCA9IDAsXHJcbiBGb3J3YXJkID0gMSxcclxuIFJlamVjdE1yZiA9IDJcclxufVxyXG5cclxuXHJcblxyXG4vKipcclxuIFNldCBhY3Rpb24gZm9yIENhbGxTdGFydCBldmVudFxyXG4qL1xyXG5pbnRlcmZhY2UgQ2FsbFN0YXJ0QWN0aW9uIHtcclxuIHR5cGUgOiBDYWxsU3RhcnRBY3Rpb25UeXBlO1xyXG4gZXJyb3Jjb2RlIDogbnVtYmVyO1xyXG4gY2F1c2UgOiBzdHJpbmcgO1xyXG4gdXJpIDogc3RyaW5nO1xyXG4gZWFybHltZWRpYSA6IG51bWJlcjtcclxuIGxlZ25hbWUgOiBzdHJpbmcgXHJcbn1cclxuXHJcbi8qKlxyXG4gU2V0IGFjdGlvbiBmb3IgQ2FsbFBvbGwgZXZlbnRcclxuKi9cclxuaW50ZXJmYWNlIENhbGxQb2xsQWN0aW9uIHtcclxuIHR5cGUgOiBDYWxsUG9sbEFjdGlvblR5cGVcclxufVxyXG5cclxuXHJcbi8qKlxyXG4gQXBwbGljYXRpb24gY2FuIHNldCBhY3Rpb24gZm9yIGEgc3BlY2lmaWMgbGVnLCB0aGlzIGlzIGFwcGxpY2FibGUgZm9yIE1SRiBjb250YWN0XHJcbiAqL1xyXG5pbnRlcmZhY2UgTGVnQWN0aW9uIHtcclxuIHR5cGUgOiBDYWxsU3RhcnRBY3Rpb25UeXBlIDtcclxuIGxlZ2FjdGlvbiA6IHN0cmluZ1xyXG59XHJcblxyXG5lbnVtIE1lZGlhT3BlcmF0aW9uQWN0aW9uVHlwZSB7XHJcbiBQZXJmb3JtTWVkaWFPcGVyYXRpb24gPSBcInBlcmZvcm1NZWRpYU9wZXJhdGlvblwiXHJcbn1cclxuXHJcbmVudW0gTWVkaWFPcGVyYXRpb25Db250ZW50VHlwZSB7XHJcbiBNU01MID0gXCJhcHBsaWNhdGlvbi9tc21sK3htbFwiXHJcbn1cclxuXHJcbmludGVyZmFjZSBQZXJmb3JtTWVkaWFPcGVyYXRpb24ge1xyXG4gQ29udGVudFR5cGUgOiBNZWRpYU9wZXJhdGlvbkNvbnRlbnRUeXBlO1xyXG4gQ29udGVudCA6IHN0cmluZ1xyXG59XHJcblxyXG5pbnRlcmZhY2UgTWVkaWFPcGVyYXRpb25BY3Rpb24ge1xyXG4gdHlwZSA6IG51bWJlcjtcclxuIGxlZ2FjdGlvbiA6IE1lZGlhT3BlcmF0aW9uQWN0aW9uVHlwZTtcclxuIHBlcmZvcm1NZWRpYU9wZXJhdGlvbiA6IFBlcmZvcm1NZWRpYU9wZXJhdGlvblxyXG59XHJcblxyXG5pbnRlcmZhY2UgQWN0aW9uIHtcclxuIGFjdGlvbiA6IGFueSBcclxufVxyXG5cclxuXHJcbmludGVyZmFjZSBIZWFkZXIge1xyXG4gaGVhZGVyIDogc3RyaW5nO1xyXG4gdmFsdWUgOiBzdHJpbmc7XHJcbn1cclxuXHJcbmludGVyZmFjZSBRSGVhZGVyIHtcclxuIFByaXZhY3kgOiBzdHJpbmc7XHJcbiBSZWFzb24gOiBzdHJpbmcgO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgUGFyYW1ldGVyIHtcclxuIHRyYW5zcG9ydCA6IHN0cmluZztcclxuIHVzZXIgOiBzdHJpbmcgO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgVVJJIHtcclxuIHNjaGVtZSA6IHN0cmluZztcclxuIGF1dGhvcml0eSA6IHN0cmluZyA7XHJcbiBnciA6IHN0cmluZyA7XHJcbiBob3N0OiBzdHJpbmcgO1xyXG4gbHIgOiBzdHJpbmcgO1xyXG4gbWFkZHIgOiBzdHJpbmcgO1xyXG4gcG9ydCA6IG51bWJlciAgO1xyXG4gdXNlciA6IHN0cmluZyA7XHJcbiBwYXJhbWV0ZXJzIDogW1BhcmFtZXRlcl07XHJcbiBxaGVhZGVyIDogW1FIZWFkZXJdO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgQWRkcmVzcyB7XHJcbiBkaXNwbGF5TmFtZSA6IHN0cmluZztcclxuIHVyaSA6IFVSSSBcclxufVxyXG5cclxuaW50ZXJmYWNlIEhpc3RvcnlJbmZvIGltcGxlbWVudHMgSGVhZGVyIHtcclxuIGFkZHJlc3MgOiBBZGRyZXNzO1xyXG4gaW5kZXggOiBzdHJpbmdcclxufVxyXG5cclxuaW50ZXJmYWNlIFBBSSBpbXBsZW1lbnRzIEhlYWRlciAge1xyXG4gYWRkcmVzcyA6IEFkZHJlc3NcclxufVxyXG5cclxuaW50ZXJmYWNlIEZyb20gaW1wbGVtZW50cyBIZWFkZXIge1xyXG4gYWRkcmVzcyA6IEFkZHJlc3M7XHJcbiB0YWcgOiBzdHJpbmcgO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgVG8gaW1wbGVtZW50cyBIZWFkZXIge1xyXG4gYWRkcmVzcyA6IEFkZHJlc3M7XHJcbiB0YWcgOiBzdHJpbmc7XHJcbn1cclxuXHJcbmludGVyZmFjZSBQQ1YgaW1wbGVtZW50cyBIZWFkZXIge1xyXG4gaWNpZF9nZW5lcmF0ZWRfYXQ6IHN0cmluZyA7XHJcbiBpY2lkX3ZhbHVlIDogc3RyaW5nIDtcclxuIG9haWQgOiBzdHJpbmc7XHJcbiB0YWlkIDogc3RyaW5nO1xyXG4gb3NpZCA6IHN0cmluZztcclxuIHRzaWQgOiBzdHJpbmc7XHJcbn1cclxuXHJcbmludGVyZmFjZSBSZXN1bHRDb2RlIHtcclxuICByZXN1bHRDb2RlIDogc3RyaW5nIDtcclxufVxyXG5cbjsvL01BSU5CTE9DS1xuO1xuLypcbi8vY29uZmlnIGlzIFwibXJmX2Fubm91bmNlbWVudHNcIlxue1xuICBcImFubm9UZXN0XCI6IHtcbiAgICBcIm1heHRpbWVcIjogMTUwMCxcbiAgICBcInBhdGhcIjogXCJmaWxlOi8vL3RtcC9hbm5vcy9cIixcbiAgICBcInZhcmlhYmxlXCI6IFwiXCIsXG4gICAgXCJiYXJnZVwiOiAxLFxuICAgIFwicHJvbXB0XCI6IFwidGVzdEFubm8ud2F2XCIsXG4gICAgXCJkdG1mXCI6IHtcbiAgICAgIFwiY2xlYXJkYlwiOiAxLFxuICAgICAgXCJpZHRcIjogMSxcbiAgICAgIFwiZmR0XCI6IDEsXG4gICAgICBcIm1pblwiOiAxLFxuICAgICAgXCJtYXhcIjogMSxcbiAgICAgIFwicnRmXCI6IFwiKlwiLFxuICAgICAgXCJjYW5jZWxcIjogXCIjXCJcbiAgICB9LFxuICAgIFwiYW5uaWRcIjogXCJhbm5vUHJvbXB0Q29sbGVjdFwiLFxuICAgIFwiaW50ZXJ2YWxcIjogMTAwLFxuICAgIFwiaXRlcmF0ZVwiOiAxLFxuICAgIFwiY2xlYXJkYlwiOiAxXG4gIH0sXG59XG5cbi8vIFhNTCBpbiBuZXh1cy1zaXAuMy4wLjEtMS5qYXJcbjw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cIlVURi04XCI/PiBcbjxtc21sIHZlcnNpb249XCIxLjFcIj4gXG5cdDxkaWFsb2dzdGFydCBuYW1lPVwiYW5ub1Byb21wdENvbGxlY3RcIiB0YXJnZXQ9XCJjb25uOmNhNDU4NTUxXCIgdHlwZT1cImFwcGxpY2F0aW9uL21vbWwreG1sXCI+IFxuXHRcdDxwbGF5IGludGVydmFsPVwiMTAwbXNcIiBpdGVyYXRlPVwiMVwiIGNsZWFyZGI9XCJ0cnVlXCIgbWF4dGltZT1cIjUwMDAwbXNcIiBiYXJnZT1cInRydWVcIj4gXG5cdFx0XHQ8YXVkaW8gdXJpPVwiZmlsZTovLy9hcHBsL3dhdi9zaW1wbGVwbGF5LndhdlwiLz4gXG5cdFx0XHQ8cGxheWV4aXQ+IFxuXHRcdFx0XHQ8ZXhpdCBuYW1lbGlzdD1cInBsYXkuZW5kIHBsYXkuYW10XCIvPiBcblx0XHRcdDwvcGxheWV4aXQ+IFxuXHRcdDwvcGxheT4gXG5cdDwvZGlhbG9nc3RhcnQ+IFxuPC9tc21sPlxuXHQgIFxuLy8gWE1MIGluIG5leHVzLXNpcC4zLjAuPz8/IGZ1dHVyZSAtIHN1cHBvcnQgcHJvbXB0IGFuZCBjb2xsZWN0XG4vLyBwYXR0ZXJuIGRpZ2l0cyB4IGlzIHdpbGRjYXJkLCB4eCBhcmUgdHdvIHdpbGRjYXJkIGRpZ2l0cywgMSBpcyB0aGUgZGlnaXQgb25lIGV4YWN0bHksIFxuLy8gPHBhdHRlcm4gZGlnaXRzPVwiMVwiIGl0ZXJhdGU9XCJmb3JldmVyXCI+ICBcbnVzaW5nIGNvbGxlY3Rcbjw/eG1sIHZlcnNpb249XCIxLjBcIj8+XG48bXNtbCB2ZXJzaW9uPVwiMS4xXCI+XG5cdDxkaWFsb2dzdGFydCB0YXJnZXQ9XCJjb25uOiR7VEFSR0VUfVwiIHR5cGU9XCJhcHBsaWNhdGlvbi9tb21sK3htbFwiIG5hbWU9XCJkaWFsb2duYW1lZGVmYXVsdFwiPlxuXHRcdDxncm91cCB0b3BvbG9neT1cInBhcmFsbGVsXCI+XG5cdFx0XHQ8cGxheSBpZD1cImJlZm9yZWJhcmdlcGxheVwiPlxuXHRcdFx0XHQ8YXVkaW8gdXJpPVwiZmlsZTovLy9hcHBsL3dhdi9zaW1wbGVwbGF5LndhdlwiIGZvcm1hdD1cImF1ZGlvL3dhdlwiICAvPlxuXHRcdFx0XHQ8cGxheWV4aXQ+XG5cdFx0XHRcdFx0PHNlbmQgdGFyZ2V0PVwiY29sbGVjdFwiIGV2ZW50PVwic3RhcnR0aW1lclwiLz5cblx0XHRcdFx0PC9wbGF5ZXhpdD5cblx0XHRcdDwvcGxheT5cblx0XHRcdDxjb2xsZWN0IGNsZWFyZGI9XCJ0cnVlXCIgZmR0PVwiNXNcIiBpZHQ9XCIzc1wiPlxuXHRcdFx0XHQ8cGF0dGVybiBkaWdpdHM9XCJ4XCI+XG5cdFx0XHRcdFx0PHNlbmQgdGFyZ2V0PVwic291cmNlXCIgZXZlbnQ9XCJkaWFsb2duYW1lZGVmYXVsdFwiIG5hbWVsaXN0PVwiZHRtZi5kaWdpdHMgZHRtZi5lbmRcIi8+XG5cdFx0XHRcdDwvcGF0dGVybj5cblx0XHRcdFx0PGRldGVjdD5cblx0XHRcdFx0XHQ8c2VuZCB0YXJnZXQ9XCJwbGF5LmJlZm9yZWJhcmdlcGxheVwiIGV2ZW50PVwidGVybWluYXRlXCIvPlxuXHRcdFx0XHQ8L2RldGVjdD5cblx0XHRcdFx0PG5vaW5wdXQ+XG5cdFx0XHRcdFx0PHNlbmQgdGFyZ2V0PVwic291cmNlXCIgZXZlbnQ9XCJkaWFsb2duYW1lZGVmYXVsdFwiIG5hbWVsaXN0PVwiZHRtZi5kaWdpdHMgZHRtZi5lbmRcIi8+XG5cdFx0XHRcdDwvbm9pbnB1dD5cblx0XHRcdFx0PG5vbWF0Y2g+XG5cdFx0XHRcdFx0PHNlbmQgdGFyZ2V0PVwic291cmNlXCIgZXZlbnQ9XCJkaWFsb2duYW1lZGVmYXVsdFwiIG5hbWVsaXN0PVwiZHRtZi5kaWdpdHMgZHRtZi5lbmRcIi8+XG5cdFx0XHRcdDwvbm9tYXRjaD5cblx0XHRcdDwvY29sbGVjdD5cblx0XHQ8L2dyb3VwPlxuXHQ8L2RpYWxvZ3N0YXJ0PlxuPC9tc21sPlxuXG5cblxuKi9cblxuZnVuY3Rpb24gU2VuZElORk9Qcm9tcHRhbmRDb2xsZWN0KHNlc3Npb24gOiBhbnksIGV2ZW50IDogYW55LCBsb2NhbFBhcmFtczogYW55ICl7XG4gICAgLy9zZXQgdGhlIHhtbCBjb25uIGlkIC0tPiBzZXNzaW9uW1wibXJmXCJdW1wiZG93blN0cmVhbVRvVGFnXCJdXG5cbi8qXG4gICAgbGV0IG91dGV2ZW50ID0ge1xuICAgIFwiY2FsbGlkXCI6IHNlc3Npb25bXCJmc20taWRcIl0sXG4gICAgXCJldmVudC10eXBlXCI6IFwic2lwXCIsXG4gICAgXCJxdWV1ZVwiOiBcIlRBU1Y0XzFcIixcbiAgICBcImlkXCI6IDIsXG4gICAgXCJ0aW1lc3RhbXBcIjogMTczOTc4NDgzNDU2MyxcbiAgICBcImFjdGlvblwiOiB7XG4gICAgICBcImxlZ2FjdGlvblwiOiBcInBlcmZvcm1NZWRpYU9wZXJhdGlvblwiLFxuICAgICAgXCJwZXJmb3JtTWVkaWFPcGVyYXRpb25cIjoge1xuICAgICAgICBcIkNvbnRlbnRUeXBlXCI6IFwiYXBwbGljYXRpb24vbXNtbCt4bWxcIixcbiAgICAgICAgXCJDb250ZW50XCI6IFwiPD94bWwgdmVyc2lvbj1cXFwiMS4wXFxcIiBlbmNvZGluZz1cXFwiVVRGLThcXFwiPz5cXG48bXNtbCAgdmVyc2lvbj1cXFwiMS4xXFxcIj5cXG48ZGlhbG9nc3RhcnQgbmFtZT1cXFwiYW5ub1Byb21wdENvbGxlY3RcXFwiIHRhcmdldD1cXFwiY29ubjo1YjAwN2M0MFxcXCIgdHlwZT1cXFwiYXBwbGljYXRpb24vbW9tbCt4bWxcXFwiPlxcbjxwbGF5IGludGVydmFsPVxcXCIxMDBtc1xcXCIgaXRlcmF0ZT1cXFwiMVxcXCIgY2xlYXJkYj1cXFwidHJ1ZVxcXCIgbWF4dGltZT1cXFwiNTAwMDBtc1xcXCIgYmFyZ2U9XFxcInRydWVcXFwiPlxcbiA8YXVkaW8gdXJpPVxcXCJmaWxlOi8vL2FwcGwvd2F2L3NpbXBsZXBsYXkud2F2XFxcIi8+XFxuIDxwbGF5ZXhpdD5cXG4gICA8ZXhpdCBuYW1lbGlzdD1cXFwicGxheS5lbmQgcGxheS5hbXRcXFwiLz5cXG4gPC9wbGF5ZXhpdD5cXG48L3BsYXk+XFxuPC9kaWFsb2dzdGFydD5cXG48L21zbWw+XCJcbiAgICAgIH0sXG4gICAgICBcInR5cGVcIjogM1xuICAgIH0sXG4gICAgXCJldmVudC1uYW1lXCI6IFwic2lwLm1lZGlhLnBsYXlBbm5vdW5jZW1lbnRcIixcbiAgICBcImV2ZW50bmFtZVwiOiBcImNhbGxFYXJseUFuc3dlcmVkXCIsXG4gICAgXCJzZXNzaW9uXCI6IHNlc3Npb25bXCJmc20taWRcIl0sXG4gICAgXCJldmVudHRpbWVcIjogMTczOTc4NDgzNDU3OVxuICB9O1xuKi9cbiAgICBsZXQgb3V0ZXZlbnQgPSB7XG4gICAgXCJjYWxsaWRcIjogc2Vzc2lvbltcImZzbS1pZFwiXSxcbiAgICBcImV2ZW50LXR5cGVcIjogXCJzaXBcIixcbiAgICBcInF1ZXVlXCI6IFwiVEFTVjRfMVwiLFxuICAgIFwiaWRcIjogMixcbiAgICBcImFjdGlvblwiOiB7XG4gICAgICBcImxlZ2FjdGlvblwiOiBcInBlcmZvcm1NZWRpYU9wZXJhdGlvblwiLFxuICAgICAgXCJwZXJmb3JtTWVkaWFPcGVyYXRpb25cIjoge1xuICAgICAgICBcIkNvbnRlbnRUeXBlXCI6IFwiYXBwbGljYXRpb24vbXNtbCt4bWxcIixcbiAgICAgICAgXCJDb250ZW50XCI6IFwiPD94bWwgdmVyc2lvbj1cXFwiMS4wXFxcIiBlbmNvZGluZz1cXFwiVVRGLThcXFwiPz5cXG48bXNtbCAgdmVyc2lvbj1cXFwiMS4xXFxcIj5cXG48ZGlhbG9nc3RhcnQgbmFtZT1cXFwiYW5ub1Byb21wdENvbGxlY3RcXFwiIHRhcmdldD1cXFwiY29ubjpcXFwic2Vzc2lvbltcIm1yZlwiXVtcImRvd25TdHJlYW1Ub1RhZ1wiXSB0eXBlPVxcXCJhcHBsaWNhdGlvbi9tb21sK3htbFxcXCI+XFxuPHBsYXkgaW50ZXJ2YWw9XFxcIjEwMG1zXFxcIiBpdGVyYXRlPVxcXCIxXFxcIiBjbGVhcmRiPVxcXCJ0cnVlXFxcIiBtYXh0aW1lPVxcXCI1MDAwMG1zXFxcIiBiYXJnZT1cXFwidHJ1ZVxcXCI+XFxuIDxhdWRpbyB1cmk9XFxcImZpbGU6Ly8vYXBwbC93YXYvc2ltcGxlcGxheS53YXZcXFwiLz5cXG4gPHBsYXlleGl0PlxcbiAgIDxleGl0IG5hbWVsaXN0PVxcXCJwbGF5LmVuZCBwbGF5LmFtdFxcXCIvPlxcbiA8L3BsYXlleGl0PlxcbjwvcGxheT5cXG48L2RpYWxvZ3N0YXJ0PlxcbjwvbXNtbD5cIlxuICAgICAgfSxcbiAgICAgIFwidHlwZVwiOiAzXG4gICAgfSxcbiAgICBcImV2ZW50LW5hbWVcIjogXCJzaXAubWVkaWEucGxheUFubm91bmNlbWVudFwiLFxuICAgIFwiZXZlbnRuYW1lXCI6IFwiY2FsbEVhcmx5QW5zd2VyZWRcIixcbiAgICBcInNlc3Npb25cIjogc2Vzc2lvbltcImZzbS1pZFwiXVxuICB9O1xuICByZXR1cm4gb3V0ZXZlbnQ7XG59XG5cblxuZnVuY3Rpb24gaW5wdXR2YWxpZGF0aW9uKHNlc3Npb24gOiBhbnksIGV2ZW50IDogYW55LCBsb2NhbFBhcmFtczogYW55ICl7XG4gICAgbGV0IGxvZyA9IHNlc3Npb24ubG9nO1xuXG4gICAgdHJ5IHtcblxuICAgICAgICAvL3NpcCBpbnZpdGUgaXMgaW4gI3Nlc3Npb25bXCJzX1NJUEludml0ZVwiXVxuICAgICAgICBpZiAoIHNlc3Npb25bXCJzX1NJUEludml0ZVwiXSAhPSBudWxsICkge1xuICAgICAgICAgICAgaWYoIHNlc3Npb25bXCJzX1NJUEludml0ZVwiXVtcImV2ZW50LXR5cGVcIl0hPT1udWxsICYmIChzZXNzaW9uW1wic19TSVBJbnZpdGVcIl1bXCJldmVudC10eXBlXCJdPT09XCJzaXBcIiB8fCBzZXNzaW9uW1wic19TSVBJbnZpdGVcIl1bXCJldmVudC10eXBlXCJdPT09XCJvY2NwXCIpKSB7XG4gICAgICAgICAgICAgICAgaWYoIHNlc3Npb25bXCJzX1NJUEludml0ZVwiXVtcImV2ZW50LW5hbWVcIl0hPT1udWxsICYmIHNlc3Npb25bXCJzX1NJUEludml0ZVwiXVtcImV2ZW50LW5hbWVcIl0gPT09IFwic2lwLmNhbGxTdGFydC5OT05FXCIpXG4gICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyhcImdvdCBzaXAgaW52aXRlXCIpO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiZXJyb3IuaW5wdXQuc2lwaW52aXRlaW5jb3JyZWN0ZXZlbnRuYW1lXCI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBcImVycm9yLmlucHV0LnNpcGludml0ZWluY29ycmVjdGV2ZW50dHlwZVwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFwiZXJyb3IuaW5wdXQuc2lwaW52aXRlbWlzc2luZ1wiO1xuICAgICAgICB9XG5cbi8vaW50ZXJpbVxuICAgIHJldHVybiBcInRydWVcIjtcblxuXG5cblxuICAgICAgICAvL2Fubm91bmNlbWVudCBzdHJpbmdcbiAgICAgICAgaWYgKCBldmVudFtcImFubm91bmNlbWVudFwiXSAhPSBudWxsICkge1xuICAgICAgICAgICAgbG9nLmRlYnVnKFwiYW5ub3VuY2VtZW50OiB7fVwiLCBldmVudFtcImFubm91bmNlbWVudFwiXSk7XG4gICAgICAgICAgICAgICAgc2Vzc2lvbltcIm1yZlwiXVtcImFubm91bmNlbWVudFwiXSA9IGV2ZW50W1wiYW5ub3VuY2VtZW50XCJdOyAgICAgICAgICAgXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gXCJlcnJvci5pbnB1dC5hY3Rpb25taXNzaW5nXCI7XG4gICAgICAgIH1cblxuICAgICAgICAvL3Byb21wdGFuZGNvbGxlY3QsIHBsYXlhbm5vdW5jZW1lbnRcbiAgICAgICAgaWYgKCAoZXZlbnRbXCJhY3Rpb25cIl0gIT0gbnVsbCkgJiYgKChldmVudFtcImFjdGlvblwiXT09PVwicHJvbXB0YW5kY29sbGVjdFwiKSB8fCAoZXZlbnRbXCJhY3Rpb25cIl09PT1cInBsYXlhbm5vdW5jZW1lbnRcIikpICkge1xuICAgICAgICAgICAgbG9nLmRlYnVnKFwiYWN0aW9uOiB7fVwiLCBldmVudFtcImFjdGlvblwiXSk7XG4gICAgICAgICAgICBpZiAoIGV2ZW50W1wiYWN0aW9uXCJdPT09XCJwcm9tcHRhbmRjb2xsZWN0XCIgKSBcbiAgICAgICAgICAgICAgICBzZXNzaW9uW1wibXJmXCJdW1wiYWN0aW9uXCJdID0gXCJwcm9tcHRhbmRjb2xsZWN0XCI7XG4gICAgICAgICAgICBlbHNlIGlmICggZXZlbnRbXCJhY3Rpb25cIl09PT1cInBsYXlhbm5vdW5jZW1lbnRcIiApIFxuICAgICAgICAgICAgICAgIHNlc3Npb25bXCJtcmZcIl1bXCJhY3Rpb25cIl0gPSBcInBsYXlhbm5vdW5jZW1lbnRcIjtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJlcnJvci5pbnB1dC5hY3Rpb25pbmNvcnJlY3RcIjsgICAgICAgICAgICBcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBcImVycm9yLmlucHV0LmFjdGlvbm1pc3NpbmdcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vZWFybHkgZGlhbG9nIGlzIGJvb2xlYW4gdHJ1ZS9mYWxzZVxuICAgICAgICBpZiAoIGV2ZW50W1wiZWFybHlkaWFsb2dcIl0gIT0gbnVsbCApIHtcbiAgICAgICAgICAgIGxvZy5kZWJ1ZyhcImVhcmx5ZGlhbG9nOiB7fVwiLCBldmVudFtcImVhcmx5ZGlhbG9nXCJdKTtcbiAgICAgICAgICAgIGlmICggZXZlbnRbXCJlYXJseWRpYWxvZ1wiXSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHNlc3Npb25bXCJtcmZcIl1bXCJlYXJseWRpYWxvZ1wiXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwidHJ1ZVwiO1xuICAgICAgICAgICAgfSBlbHNlIGlmICggZXZlbnRbXCJlYXJseWRpYWxvZ1wiXSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICBzZXNzaW9uW1wibXJmXCJdW1wiZWFybHlkaWFsb2dcIl0gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJmYWxzZVwiO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJlcnJvci5pbnB1dC5lYXJseWRpYWxvZ2luY29ycmVjdFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFwiZXJyb3IuaW5wdXQuZWFybHlkaWFsb2dcIjtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgbG9nLmRlYnVnKFwiTG9nOiB7fVwiLCBlKTtcbiAgICAgICAgcmV0dXJuIFwiZXJyb3IuZXhjZXB0aW9uXCI7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBhcm1NUkZldmVudHMoc2Vzc2lvbkRhdGE6YW55LGV2ZW50RGF0YTphbnksbG9jYWxQYXJhbXM6YW55KTogYW55IHtcbiBsZXQgcmV0OiBSZXN1bHRDb2RlIDtcblxuICAgIGxldCBzdGF0dXMyIDogc3RyaW5nO1xuICAgIGxldCBldmVudHMgOiBFdmVudHM7XG4gICAgZXZlbnRzID0gZXZlbnRzIHx8IHt9O1xuICAgIGV2ZW50cy5JbmZvUG9sbEV2ZW50PVwibnVsbFwiO1xuICAgIGV2ZW50cy5TdWNjZXNzUmVzcG9uc2VQb2xsRXZlbnQ9XCJudWxsXCI7XG4gICAgZXZlbnRzLlJhd0NvbnRlbnRQb2xsRXZlbnQ9XCJ0ZXN0L3Rlc3RcIjtcblxuICAgIGxldCBoZWFkZXJWYXJzIDogSGVhZGVyVmFycztcbiAgICBoZWFkZXJWYXJzID0gaGVhZGVyVmFycyB8fCB7fTtcbiAgICBoZWFkZXJWYXJzLmRpc2FibGVTZW5kRGVmYXVsdFJlYXNvbiA9IFwiRGlzYWJsZWRcIjtcbiAgICBoZWFkZXJWYXJzLmRpc2FibGVTZW5kTm9BbnN3ZXJSZWFzb24gPSBcIkRpc2FibGVkXCI7XG5cbiAgICBsZXQgcmluZ2luZ1RvbmVzIDogW1JpbmdpbmdUb25lXTtcbiAgICByaW5naW5nVG9uZXMgPSByaW5naW5nVG9uZXMgfHwgW107XG4gICAgbGV0IGNvbWYgOiBSaW5naW5nVG9uZTtcbiAgICBjb21mID0gY29tZiB8fCB7fTtcbiAgICBjb21mLmFubm9fbmFtZT1cImNvbWZvcnRcIjtcbiAgICBjb21mLmFubm9fdHlwZT1Bbm5vdHlwZS5DT05ORUNUO1xuICAgIGxldCByaW5nIDogUmluZ2luZ1RvbmU7XG4gICAgcmluZyA9IHJpbmcgfHwge307XG4gICAgcmluZy5hbm5vX25hbWU9XCJyaW5naW5nXCI7XG4gICAgcmluZy5hbm5vX3R5cGU9QW5ub3R5cGUuUklOR0lORztcbiAgICByaW5naW5nVG9uZXMucHVzaChjb21mLCByaW5nKTtcblxuICAgIGxldCBjYXBhYmlsaXRpZXMgPSBzZXNzaW9uRGF0YS5pbkNhcGFiaWxpdGllcztcbiAgICBpZiggY2FwYWJpbGl0aWVzIT1udWxsKXtcbiAgICAgICAgY2FwYWJpbGl0aWVzLnB1c2goQ2FwYWJpbGl0aWVzLlBFTSk7XG4gICAgICAgIGNhcGFiaWxpdGllcy5wdXNoKENhcGFiaWxpdGllcy5GT1JLSU5HKTtcbiAgICAgICAgY2FwYWJpbGl0aWVzLnB1c2goQ2FwYWJpbGl0aWVzLlVQREFURSk7XG4gICAgICAgIGNhcGFiaWxpdGllcy5wdXNoKENhcGFiaWxpdGllcy5JTkZPKTtcbiAgICAgICAgc2Vzc2lvbkRhdGEub3V0Q2FwYWJpbGl0aWVzID0gSlNPTi5zdHJpbmdpZnkoY2FwYWJpbGl0aWVzKTtcbiAgICB9XG5cbiAgICBzZXNzaW9uRGF0YS5ldmVudHMgPSBKU09OLnN0cmluZ2lmeShldmVudHMpO1xuICAgIHNlc3Npb25EYXRhLmhlYWRlcnJ1bGV2YXI9SlNPTi5zdHJpbmdpZnkoaGVhZGVyVmFycyk7XG4gICAgc2Vzc2lvbkRhdGEuaGVhZGVycnVsZXNzZWxlY3QgPSBcIlNpcFNlcnZpY2VTcGVjaWZpY1J1bGVzU2V0XCI7XG4gICAgc2Vzc2lvbkRhdGEucmluZ2luZ3RvbmVzID0gSlNPTi5zdHJpbmdpZnkocmluZ2luZ1RvbmVzKTtcbiAgICBzZXNzaW9uRGF0YS51cHN0cmVhbUNhcGFiaWxpdGllcz1KU09OLnN0cmluZ2lmeShbXSk7XG5cbiAgICByZXR1cm4gXCJzdWNjZXNzXCI7XG59XG5cblxuZnVuY3Rpb24gaGFuZGxlMjAwT0tJTlZJVEUoc2Vzc2lvbjphbnksZXZlbnQ6T0NDUFNJUC5PQ0NQRXZlbnQsbG9jYWxQYXJhbXM6YW55KSB7XG4gICAgbGV0IGxvZyA9IHNlc3Npb24ubG9nO1xuXG4gICAgdHJ5IHtcbiAgICAgICAgLy90aGUgcmVjZWl2ZWQgZXZlbnQgaXMgbm93IGluIGxvY2FsUGFyYW1zXG4gICAgICAgIGxldCBldmVudERhdGEgPSBsb2NhbFBhcmFtcy5tZXNzYWdlO1xuICAgICAgICAvL3Nlc3Npb24uZXZlbnRzID0gbnVsbDtcbiAgICAgICAgc2Vzc2lvbltcIm1yZlwiXVtcImhlYWRlcnJ1bGV2YXI9bnVsbFwiXTtcbiAgICAgICAgc2Vzc2lvbltcIm1yZlwiXVtcImhlYWRlcnJ1bGVzc2VsZWN0XCJdID0gbnVsbDtcbiAgICAgICAgc2Vzc2lvbltcIm1yZlwiXVtcInJpbmdpbmd0b25lc1wiXSA9IG51bGw7XG5cbiAgICAgICAgbGV0IHBvbGxBY3Rpb24gOiBDYWxsUG9sbEFjdGlvbjtcbiAgICAgICAgcG9sbEFjdGlvbiA9IHBvbGxBY3Rpb24gfHwge307XG4gICAgICAgIHBvbGxBY3Rpb24udHlwZSA9IENhbGxQb2xsQWN0aW9uVHlwZS5BY2NlcHQ7XG4gICAgICAgIHNlc3Npb24uc2VuZEFjdGlvbiA9IEpTT04uc3RyaW5naWZ5KHBvbGxBY3Rpb24pO1xuXG4gICAgICAgIHNlc3Npb25bXCJtcmZcIl1bXCJ0aW1lMjAwT0tJTlZJVEVcIl0gID0gTWF0aC5mbG9vcihuZXcgRGF0ZSgpLzEwMDApO1xuXG4gICAgICAgIC8vc2F2ZSB0byB0YWdcbiAgICAgICAgbGV0IHRvIDogVG8gPSBldmVudERhdGEuU0lQLlRvO1xuICAgICAgICBpZiggdG8hPW51bGwpIHtcbiAgICAgICAgICAgIGxvZy5kZWJ1ZyhcInJlY2VpdmVkIGZyb20gTVJGIHRvIHRhZzp7fVwiLHRvKTtcbiAgICAgICAgICAgIHNlc3Npb25bXCJtcmZcIl1bXCJjYWxsc3RhdGVcIl0gID0gXCJNUkZDT05ORUNURUQyMDBPS1wiO1xuICAgICAgICAgICAgc2Vzc2lvbltcIm1yZlwiXVtcImRvd25TdHJlYW1Ub1RhZ1wiXT10by50YWc7XG4gICAgICAgICAgICByZXR1cm4gXCJzdWNjZXNzXCI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsb2cuZGVidWcoXCJyZWNlaXZlZCBmcm9tIE1SRiBubyB0byB0YWc6e31cIix0byk7XG4gICAgICAgICAgICByZXR1cm4gXCJlcnJvci5ub3RvdGFnXCI7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBsb2cuZGVidWcoXCJoYW5kbGUyMDBPS0lOVklURSBMb2c6IHt9XCIsIGUpO1xuICAgICAgICByZXR1cm4gXCJlcnJvci5leGNlcHRpb25cIjtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGhhbmRsZTIwME9LSU5GTyhzZXNzaW9uOmFueSxldmVudDpPQ0NQU0lQLkV2ZW50LGxvY2FsUGFyYW1zOkxvY2FsUGFyYW1ldGVycyk6IGFueXtcbiAgICBsZXQgbG9nID0gc2Vzc2lvbi5sb2c7XG5cbiAgICB0cnkgeyAgICAgICAgXG4gICAgICAgIHNlc3Npb25bXCJtcmZcIl1bXCJ0aW1lMjAwT0tJTkZPXCJdICA9IE1hdGguZmxvb3IobmV3IERhdGUoKS8xMDAwKTtcbiAgICAgICAgc2Vzc2lvbltcIm1yZlwiXVtcImNhbGxzdGF0ZVwiXSAgPSBcIk1SRkNPTk5FQ1RFRFwiO1xuICAgICAgICBpZiAoZXZlbnQuU0lQLmNvbnRlbnQuanNvbi5tc21sLmV2ZW50Lm5hbWVbMl0hPW51bGwpIHtcbiAgICAgICAgICAgIGlmIChldmVudC5TSVAuY29udGVudC5qc29uLm1zbWwuZXZlbnQubmFtZVsyXT09XCJkdG1mLmRpZ2l0c1wiKSB7XG4gICAgICAgICAgICAgICAgbG9nLmRlYnVnKFwiR290IERUTUYgZGlnaXRzO1wiKTtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuU0lQLmNvbnRlbnQuanNvbi5tc21sLmV2ZW50LnZhbHVlWzFdIT1udWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlc3Npb25bXCJtcmZcIl1bXCJkdG1mZGlnaXRcIl09ZXZlbnQuU0lQLmNvbnRlbnQuanNvbi5tc21sLmV2ZW50LnZhbHVlWzFdOyAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uW1wibXJmXCJdW1wiZHRtZmRpZ2l0XCJdPVwiMFwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbG9nLmRlYnVnKFwiTm8gRFRNRiBkaWdpdHM7XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBsb2cuZGVidWcoXCJMb2c6IHt9XCIsIGUpO1xuICAgICAgICByZXR1cm4gXCJlcnJvci5leGNlcHRpb25cIjtcbiAgICB9XG4gICAgcmV0dXJuIHNlc3Npb25bXCJtcmZcIl1bXCJkdG1mZGlnaXRcIl07XG59XG5cbmZ1bmN0aW9uIGNhbGxBbnN3ZXJlZChzZXNzaW9uIDogYW55LCBldmVudCA6IGFueSwgbG9jYWxQYXJhbXM6IGFueSApe1xuICAgIGxldCBsb2cgPSBzZXNzaW9uLmxvZztcblxuICAgIHRyeSB7ICAgICAgICBcbiAgICAgICAgc2Vzc2lvbltcIm1yZlwiXVtcImNhbGxzdGF0ZVwiXSAgPSBcIkFOU1dFUkVEXCI7XG4gICAgICAgIHNlc3Npb25bXCJtcmZcIl1bXCJhbnN3ZXJ0aW1lXCJdICA9IE1hdGguZmxvb3IobmV3IERhdGUoKS8xMDAwKTtcbiAgICAgICAgcmV0dXJuIFwic3VjY2Vzc1wiO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgbG9nLmRlYnVnKFwiTG9nOiB7fVwiLCBlKTtcbiAgICAgICAgcmV0dXJuIFwiZXJyb3IuZXhjZXB0aW9uXCI7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBjaGVja0Rpc2Nvbm5lY3RSZWFzb24oc2Vzc2lvbiA6IGFueSwgZXZlbnQgOiBhbnksIGxvY2FsUGFyYW1zOiBhbnkgKXtcbiAgICBsZXQgbG9nID0gc2Vzc2lvbi5sb2c7XG5cbiAgICB0cnkgeyAgXG4gICAgICAgIHNlc3Npb25bXCJtcmZcIl1bXCJjYWxsc3RhdGVcIl0gID0gXCJDb25uZWN0RXJyb3JcIjtcbiAgICAgICAgc2Vzc2lvbltcIm1yZlwiXVtcImNvbm5lY3RlcnJvcnRpbWVcIl0gID0gTWF0aC5mbG9vcihuZXcgRGF0ZSgpLzEwMDApOyAgICAgICAgXG4gICAgICAgIGxldCBldmVudHNTdGFjaz1ldmVudFsnZXZlbnRzLXN0YWNrJ107XG4gICAgICAgIGlmKCBldmVudHNTdGFjayE9bnVsbCAmJiBldmVudHNTdGFjay5zaXplKCk+MCApe1xuICAgICAgICAgICAgZm9yKHZhciBpPWV2ZW50c1N0YWNrLnNpemUoKS0xO2k+PTA7aS0tKXtcbiAgICAgICAgICAgICAgICBpZiggZXZlbnRzU3RhY2suZ2V0KGkpLmVxdWFscyhcImxlZy50aW1lb3V0XCIpICYmIGk+PShldmVudHNTdGFjay5zaXplKCktMikpe1xuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLmxvZ2luZm8gPSBzZXNzaW9uLmxvZ2luZm8rXCJUSU1FT1VUO1wiOyBcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiZXJyb3IubXJmLmNvbm5lY3QudGltZW91dFwiOyAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgbG9nLmRlYnVnKFwiTG9nOiB7fVwiLCBlKTtcbiAgICAgICAgcmV0dXJuIFwiZXJyb3IubXJmLmNvbm5lY3QuZXhjZXB0aW9uXCI7XG4gICAgfSAgICAgICAgXG4gICAgcmV0dXJuIFwiZXJyb3IubXJmLmNvbm5lY3Qub3RoZXJzXCI7XG59XG5cbmZ1bmN0aW9uIHNldHJlbGVhc2Uoc2Vzc2lvbiA6IGFueSwgZXZlbnQgOiBhbnksIGxvY2FsUGFyYW1zOiBhbnkgKXtcbiAgICBsZXQgbG9nID0gc2Vzc2lvbi5sb2c7XG5cbiAgICB0cnkgeyAgXG4gICAgICAgIHNlc3Npb25bXCJtcmZcIl1bXCJjYWxsc3RhdGVcIl0gID0gXCJSZWxlYXNlZFwiO1xuICAgICAgICBzZXNzaW9uW1wibXJmXCJdW1wicmVsZWFzZXRpbWVcIl0gID0gTWF0aC5mbG9vcihuZXcgRGF0ZSgpLzEwMDApOyAgICAgICAgXG4gICAgICAgIHJldHVybiBcInN1Y2Nlc3NcIjtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhcIkxvZzoge31cIiwgZSk7XG4gICAgICAgIHJldHVybiBcImVycm9yLnJlbGVhc2VcIjtcbiAgICB9ICAgICAgICBcbn1cblxuZnVuY3Rpb24gcHJlcGFyZUNhbGxSb3V0aW5nKHNlc3Npb246YW55LGV2ZW50RGF0YTphbnksbG9jYWxQYXJhbXM6YW55KTogYW55IHtcbiBsZXQgcmV0OiBSZXN1bHRDb2RlIDtcbiAgICByZXQgPSByZXQgfHwge307XG4gICAgcmV0LnJlc3VsdENvZGU9XCJzdWNjZXNzXCI7XG4gICAgbGV0IHN0YXR1czIgOiBzdHJpbmc7XG4gICAgbGV0IGV2ZW50cyA6IEV2ZW50cztcbiAgICBldmVudHMgPSBldmVudHMgfHwge307XG4gICAgZXZlbnRzLkluZm9Qb2xsRXZlbnQ9XCJudWxsXCI7XG4gICAgZXZlbnRzLlN1Y2Nlc3NSZXNwb25zZVBvbGxFdmVudD1cIm51bGxcIjtcbiAgICBldmVudHMuUmF3Q29udGVudFBvbGxFdmVudD1cInRlc3QvdGVzdFwiO1xuICAgIGxldCBoZWFkZXJWYXJzIDogSGVhZGVyVmFycztcbiAgICBoZWFkZXJWYXJzID0gaGVhZGVyVmFycyB8fCB7fTtcbiAgICBoZWFkZXJWYXJzLmRpc2FibGVTZW5kRGVmYXVsdFJlYXNvbiA9IFwiRGlzYWJsZWRcIjtcbiAgICBoZWFkZXJWYXJzLmRpc2FibGVTZW5kTm9BbnN3ZXJSZWFzb24gPSBcIkRpc2FibGVkXCI7XG4gICAgbGV0IHJpbmdpbmdUb25lcyA6IFtSaW5naW5nVG9uZV07XG4gICAgcmluZ2luZ1RvbmVzID0gcmluZ2luZ1RvbmVzIHx8IFtdO1xuICAgIGxldCBjb21mIDogUmluZ2luZ1RvbmU7XG4gICAgY29tZiA9IGNvbWYgfHwge307XG4gICAgY29tZi5hbm5vX25hbWU9XCJjb21mb3J0XCI7XG4gICAgY29tZi5hbm5vX3R5cGU9QW5ub3R5cGUuQ09OTkVDVDtcbiAgICBsZXQgcmluZyA6IFJpbmdpbmdUb25lO1xuICAgIHJpbmcgPSByaW5nIHx8IHt9O1xuICAgIHJpbmcuYW5ub19uYW1lPVwicmluZ2luZ1wiO1xuICAgIHJpbmcuYW5ub190eXBlPUFubm90eXBlLlJJTkdJTkc7XG4gICAgcmluZ2luZ1RvbmVzLnB1c2goY29tZiwgcmluZyk7XG4gICAgbGV0IGNhcGFiaWxpdGllcyA9IHNlc3Npb25EYXRhLmluQ2FwYWJpbGl0aWVzO1xuICAgIGlmKCBjYXBhYmlsaXRpZXMhPW51bGwpe1xuICAgICAgICBjYXBhYmlsaXRpZXMucHVzaChDYXBhYmlsaXRpZXMuUEVNKTtcbiAgICAgICAgY2FwYWJpbGl0aWVzLnB1c2goQ2FwYWJpbGl0aWVzLkZPUktJTkcpO1xuICAgICAgICBzZXNzaW9uRGF0YS5vdXRDYXBhYmlsaXRpZXMgPSBKU09OLnN0cmluZ2lmeShjYXBhYmlsaXRpZXMpO1xuICAgIH1cbiAgICBzZXNzaW9uLmV2ZW50cyA9IEpTT04uc3RyaW5naWZ5KGV2ZW50cyk7XG4gICAgc2Vzc2lvbi5oZWFkZXJydWxldmFyPUpTT04uc3RyaW5naWZ5KGhlYWRlclZhcnMpO1xuICAgIHNlc3Npb24uaGVhZGVycnVsZXNzZWxlY3QgPSBcIlNpcFNlcnZpY2VTcGVjaWZpY1J1bGVzU2V0XCI7XG4gICAgc2Vzc2lvbi5yaW5naW5ndG9uZXMgPSBKU09OLnN0cmluZ2lmeShyaW5naW5nVG9uZXMpO1xuICAgIHNlc3Npb24udXBzdHJlYW1DYXBhYmlsaXRpZXM9SlNPTi5zdHJpbmdpZnkoW10pO1xuICAgIHN0YXR1czIgPSBcInN1Y2Nlc3NcIjtcbiAgICByZXR1cm4gcmV0O1xufVxuIl19